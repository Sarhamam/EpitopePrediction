# Epitope Prediction

EpitopePrediction is a python module that uses LSTM to predict epitopes in linear amino acids sequences.

## Installation

### TAU Nova Server

```bash
# Go to the submission directory
cd /home/iscb/wolfson/bio3d_ws_2021b/sarhamam/
# Alias conda (If you dont have it installed in your account already!
source /home/iscb/wolfson/bio3d_ws_2021b/sarhamam/venv/etc/profile.d/conda.csh
# Activate the conda environment with the requirements installed, or create your own.
conda activate /home/iscb/wolfson/bio3d_ws_2021b/sarhamam/venv/envs
# Add the source directory to your PYTHONPATH
PYTHONPATH=/home/iscb/wolfson/bio3d_ws_2021b/sarhamam/project/src:$PYTHONPATH
```

### Outside of TAU Nova Server
Using python version `3.7.10` run 
```bash
pip install -r $PROJECT_FOLDER/src/requirements.txt
set PYTHONPATH=$PROJECT_FOLDER/src:$PYTHONPATH
```
Where the project folder is the location the submitted zip file was extracted to.


## Usage

The module has two mods of operations - `predict` and `train`.

### Predict mode
#### Flags
`-input` - Input file, expected to be fasta format

`-output` - Output file, json with the probabilities of each file in the fasta

### Train mode
#### Flags
`-input` - Input file, expected to be fasta format

`-output` - Output file, weights of the trained network
### Optionals
`-weights` - Weights file generated by train mode (defaults to pretrained weights file)

`-batch_size` - Batch size for the network (Default <X>)

`-bidirectional` - Bidirectional LSTM (default True)

`-concat_at_dense` - Concat numerical properties with LSTM output (default True)

`-lstm_window_size` - LSTM Window size (default 0)

`-lstm_window_shift` - LSTM Window shift (default 0) 

`-properties-window` - The window size to calculate the physical properties (default 1)

`-epochs` - Number of epochs to train (default 50, relevant only to train)

`-early-stop`  - Preform early stopping to avoid overfitting (default True, relevant only to train)


Note that changing any of the optionals will require you to train the network with the same flags.
#### Examples
Run with default weights
```bash
python src/main.py --predict -input_file resources/example.fasta -output_file -output.json
````
Train network with different parameters and then predict
```bash
python src/main.py --train -input_file resources/db.fasta -output_file weights.pytw \\
-bidirectional False -properties-window 3 -epochs 1

python src/main.py --predict -input_file resources/example.fasta -output_file -output.json \\
-weights weights.pytw -bidirectional False -properties-window 3
````

## Logs
Runtime logs are located at `$PROJECT_FOLDER/logs/`.
